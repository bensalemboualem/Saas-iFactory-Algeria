<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workflow Studio - IAFactory Algeria</title>
    <link rel="icon" href="https://flagcdn.com/dz.svg" type="image/svg+xml">
    <link rel="stylesheet" href="../shared/iafactory-unified.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { margin: 0; padding-top: var(--iaf-header-height, 60px); min-height: 100vh; font-family: var(--iaf-font-primary); background: var(--iaf-bg); color: var(--iaf-text); }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .hero { text-align: center; padding: 2rem 0; }
        .hero h1 { font-size: 2rem; margin-bottom: 0.5rem; display: flex; align-items: center; justify-content: center; gap: 0.75rem; }
        .hero h1 i { color: var(--iaf-green); }
        .hero p { color: var(--iaf-text-secondary); }
        .new-project { background: var(--iaf-bg-card); border: 1px solid var(--iaf-border); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; }
        .new-project h2 { font-size: 1.25rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; color: var(--iaf-text-secondary); font-size: 0.875rem; }
        .form-group input { width: 100%; padding: 0.75rem 1rem; background: var(--iaf-bg); border: 1px solid var(--iaf-border); border-radius: 8px; color: var(--iaf-text); }
        .form-group input:focus { outline: none; border-color: var(--iaf-green); }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: all 0.2s; }
        .btn-primary { background: var(--iaf-gradient); color: white; }
        .btn-primary:hover { transform: translateY(-2px); }
        .pipeline-section { margin-bottom: 2rem; }
        .pipeline-section h2 { font-size: 1.25rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .pipeline-stages { display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; }
        .stage-card { background: var(--iaf-bg-card); border: 1px solid var(--iaf-border); border-radius: 12px; padding: 1.5rem; width: 150px; text-align: center; transition: all 0.3s; position: relative; }
        .stage-card:hover { border-color: var(--iaf-green); transform: translateY(-4px); }
        .stage-card.active { border-color: var(--iaf-green); box-shadow: 0 0 20px rgba(0, 166, 81, 0.3); animation: pulse-glow 2s infinite; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 5px rgba(0, 166, 81, 0.3); } 50% { box-shadow: 0 0 20px rgba(0, 166, 81, 0.5); } }
        .stage-icon { font-size: 2rem; margin-bottom: 0.75rem; }
        .stage-name { font-weight: 600; font-size: 0.875rem; margin-bottom: 0.25rem; }
        .stage-desc { font-size: 0.7rem; color: var(--iaf-text-secondary); }
        .stage-status { margin-top: 0.5rem; font-size: 0.7rem; }
        .output-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }
        .output-card { background: var(--iaf-bg-card); border: 1px solid var(--iaf-border); border-radius: 12px; padding: 1.5rem; }
        .output-card h3 { font-size: 1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .output-content { background: var(--iaf-bg); border-radius: 8px; padding: 1rem; min-height: 120px; font-size: 0.875rem; color: var(--iaf-text-secondary); }
        .footer-spacer { height: 100px; }
        @media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } .output-grid { grid-template-columns: 1fr; } .pipeline-stages { flex-direction: column; align-items: center; } }
    </style>
    <script src="../shared/footer-inject.js" defer></script>
</head>
<body data-theme="dark">

    <!-- Header -->
<header class="iaf-header" role="banner">
    <div class="iaf-header-container">
        <div class="header-logo" dir="ltr">
            <svg width="48" height="48" viewBox="0 0 100 100" style="margin-right: 10px;">
                <style>
                    @keyframes pulse { 0%, 100% { r: 5; opacity: 1; } 50% { r: 7; opacity: 0.7; } }
                    @keyframes pulse2 { 0%, 100% { r: 5; opacity: 0.7; } 50% { r: 7; opacity: 1; } }
                    .node1 { animation: pulse 2s ease-in-out infinite; }
                    .node2 { animation: pulse2 2s ease-in-out infinite 0.25s; }
                    .node3 { animation: pulse 2s ease-in-out infinite 0.5s; }
                    .node4 { animation: pulse2 2s ease-in-out infinite 0.75s; }
                    .node5 { animation: pulse 2s ease-in-out infinite 1s; }
                    .node6 { animation: pulse2 2s ease-in-out infinite 1.25s; }
                    .node7 { animation: pulse 2s ease-in-out infinite 1.5s; }
                    .node8 { animation: pulse2 2s ease-in-out infinite 1.75s; }
                </style>
                <line x1="50" y1="5" x2="85" y2="20" stroke="#00a651" stroke-width="2"/>
                <line x1="85" y1="20" x2="95" y2="50" stroke="#00a651" stroke-width="2"/>
                <line x1="95" y1="50" x2="85" y2="80" stroke="#00a651" stroke-width="2"/>
                <line x1="85" y1="80" x2="50" y2="95" stroke="#00a651" stroke-width="2"/>
                <line x1="50" y1="95" x2="15" y2="80" stroke="#00a651" stroke-width="2"/>
                <line x1="15" y1="80" x2="5" y2="50" stroke="#00a651" stroke-width="2"/>
                <line x1="5" y1="50" x2="15" y2="20" stroke="#00a651" stroke-width="2"/>
                <line x1="15" y1="20" x2="50" y2="5" stroke="#00a651" stroke-width="2"/>
                <circle cx="50" cy="5" r="5" fill="#00a651" class="node1"/>
                <circle cx="85" cy="20" r="5" fill="#ef4444" class="node2"/>
                <circle cx="95" cy="50" r="5" fill="#00a651" class="node3"/>
                <circle cx="85" cy="80" r="5" fill="#ef4444" class="node4"/>
                <circle cx="50" cy="95" r="5" fill="#00a651" class="node5"/>
                <circle cx="15" cy="80" r="5" fill="#ef4444" class="node6"/>
                <circle cx="5" cy="50" r="5" fill="#00a651" class="node7"/>
                <circle cx="15" cy="20" r="5" fill="#ef4444" class="node8"/>
                <circle cx="50" cy="50" r="32" fill="#00a651"/>
                <text x="50" y="52" font-family="Arial Black, sans-serif" font-size="28" font-weight="900" text-anchor="middle" dominant-baseline="middle" fill="white">
                    <tspan font-size="22">i</tspan><tspan font-size="28">AF</tspan>
                </text>
            </svg>
            <span class="logo-text" style="font-size: 16px; position: relative; display: inline-block;">
                <span style="position: relative; display: inline-block; overflow: hidden;">
                    <span class="letter i-bounce" style="color: #00a651;">i</span><span class="letter" style="color: #00a651;">A</span><span class="letter" style="color: var(--text);">F</span><span class="letter" style="color: var(--text);">a</span><span class="letter" style="color: var(--text);">c</span><span class="letter" style="color: var(--text);">t</span><span class="letter" style="color: var(--text);">o</span><span class="letter" style="color: #ef4444; animation: bounce 1.5s ease-in-out infinite;">r</span><span class="letter" style="color: #ef4444; animation: bounce 1.5s ease-in-out infinite 0.15s;">y</span>
                    <span style="position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); animation: flash 2.5s ease-in-out infinite;"></span>
                </span>
                <span> </span>
                <span style="position: relative; display: inline-block; overflow: hidden;">
                    <span class="letter" style="color: var(--text);">A</span><span class="letter" style="color: var(--text);">l</span><span class="letter" style="color: var(--text);">g</span><span class="letter" style="color: var(--text);">e</span><span class="letter" style="color: var(--text);">r</span><span class="letter i-bounce" style="color: #00a651;">i</span><span class="letter" style="color: #00a651;">a</span>
                    <span style="position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); animation: flash 2.5s ease-in-out infinite 0.3s;"></span>
                </span>
            </span>
        </div>
        <nav class="iaf-nav" role="navigation">
            <a href="../iafactory-landing/index.html" class="iaf-nav-link"><i class="fa-solid fa-home iaf-nav-icon"></i><span>Accueil</span></a>
            <a href="../iafactory-landing/apps.html" class="iaf-nav-link"><i class="fa-solid fa-th iaf-nav-icon"></i><span>Applications</span></a>
            <a href="../iafactory-landing/docs/directory/agents.html" class="iaf-nav-link"><i class="fa-solid fa-robot iaf-nav-icon"></i><span>Agents IA</span></a>
            <a href="../iafactory-landing/workflows.html" class="iaf-nav-link"><i class="fa-solid fa-diagram-project iaf-nav-icon"></i><span>Workflows</span></a>
        </nav>
    </div>
</header>
    <div class="container">
        <div class="hero">
            <h1><i class="fas fa-project-diagram"></i> <span data-i18n="workflow_title">Workflow Studio</span></h1>
            <p data-i18n="workflow_subtitle">Creez des workflows automatises avec BMAD, Archon et Bolt</p>
        </div>
        <section class="new-project">
            <h2><span>✨</span> <span data-i18n="new_project">Nouveau Projet</span></h2>
            <div class="form-grid">
                <div class="form-group"><label data-i18n="project_name">Nom du Projet</label><input type="text" id="project-name" placeholder="MonApplication"></div>
                <div class="form-group"><label data-i18n="project_desc">Description</label><input type="text" id="project-description" placeholder="Une application qui..."></div>
            </div>
            <button class="btn btn-primary" onclick="startWorkflow()"><span>🚀</span> <span data-i18n="start_workflow">Demarrer le Workflow</span></button>
        </section>
        <section class="pipeline-section">
            <h2><span>📋</span> <span data-i18n="pipeline">Pipeline de Creation</span></h2>
            <div class="pipeline-stages">
                <div class="stage-card" data-stage="brainstorm"><div class="stage-icon">🧠</div><div class="stage-name">BMAD Brainstorm</div><div class="stage-desc">Ideation</div><div class="stage-status"></div></div>
                <div class="stage-card" data-stage="planning"><div class="stage-icon">📊</div><div class="stage-name">BMAD Planning</div><div class="stage-desc">Plan detaille</div><div class="stage-status"></div></div>
                <div class="stage-card" data-stage="orchestrator"><div class="stage-icon">🎯</div><div class="stage-name">Orchestrateur</div><div class="stage-desc">Coordination</div><div class="stage-status"></div></div>
                <div class="stage-card" data-stage="archon"><div class="stage-icon">📚</div><div class="stage-name">Archon KB</div><div class="stage-desc">Knowledge base</div><div class="stage-status"></div></div>
                <div class="stage-card" data-stage="prompt"><div class="stage-icon">✍️</div><div class="stage-name">Prompt Creator</div><div class="stage-desc">Preparation</div><div class="stage-status"></div></div>
                <div class="stage-card" data-stage="bolt"><div class="stage-icon">⚡</div><div class="stage-name">Bolt.diy</div><div class="stage-desc">Generation code</div><div class="stage-status"></div></div>
            </div>
        </section>
        <section class="output-grid">
            <div class="output-card"><h3><span>🧠</span> Resultat Brainstorm</h3><div class="output-content" id="brainstorm-output">En attente...</div></div>
            <div class="output-card"><h3><span>📋</span> Plan Projet</h3><div class="output-content" id="plan-output">En attente...</div></div>
            <div class="output-card" style="grid-column: span 2;"><h3><span>✍️</span> Prompt Genere</h3><div class="output-content" id="prompt-output">En attente...</div><button class="btn btn-primary" id="send-to-bolt" onclick="sendToBolt()" style="margin-top:1rem" disabled><span>⚡</span> Envoyer a Bolt</button></div>
        </section>
    </div>
    <div class="footer-spacer"></div>
<!-- Footer Component - IAFactory Algeria -->
<div data-iaf-footer></div>
<script>document.getElementById('current-year').textContent = new Date().getFullYear();</script>
    <div id="iaf-chatbot" data-iaf-chatbot></div>
    <script src="../shared/iafactory-unified.js"></script>
    <script>
        const API_URL = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') ? 'http://localhost:8180' : window.location.origin + '/workflow';
        let currentWorkflowId = null;
        async function startWorkflow() {
            const name = document.getElementById('project-name').value;
            const description = document.getElementById('project-description').value;
            if (!name || !description) { alert('Veuillez remplir tous les champs'); return; }
            document.querySelectorAll('.stage-card').forEach(c => c.classList.remove('active'));
            document.querySelector('[data-stage="brainstorm"]').classList.add('active');
            document.getElementById('brainstorm-output').textContent = 'Traitement en cours...';
            try {
                const response = await fetch(API_URL + '/api/workflow/start', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ project_name: name, project_description: description, auto_execute: true }) });
                const data = await response.json();
                currentWorkflowId = data.workflow_id;
                updateUI(data);
            } catch (error) { console.error('Error:', error); document.getElementById('brainstorm-output').textContent = 'Demo mode: ' + name; }
        }
        function updateUI(data) {
            if (data.brainstorm_result) document.getElementById('brainstorm-output').textContent = JSON.stringify(data.brainstorm_result, null, 2);
            if (data.project_plan) document.getElementById('plan-output').textContent = JSON.stringify(data.project_plan, null, 2);
            if (data.final_prompt) { document.getElementById('prompt-output').textContent = data.final_prompt; document.getElementById('send-to-bolt').disabled = false; }
        }
        function sendToBolt() { alert('Envoi vers Bolt.diy...'); }
    </script>

    <!-- Chatbot Help -->
    <script>
    fetch('../shared/help-chatbot.html')
        .then(r => r.text())
        .then(html => document.body.insertAdjacentHTML('beforeend', html));
    </script>
</body>
</html>